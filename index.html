<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–º–µ–π–Ω—ã–µ –ó–∞–¥–∞—á–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
        .task-form {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .task-form input, .task-form button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .task-form button {
            background-color: #2481cc;
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }
        .task-list {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .task-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }
        .task-item:last-child {
            border-bottom: none;
        }
        .task-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .task-datetime {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="task-form">
            <input type="text" id="taskTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
            <input type="datetime-local" id="taskDateTime">
            <button onclick="createTask()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
        <div class="task-list" id="taskList">
            <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.ready(); // –°–æ–æ–±—â–∏—Ç—å Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ

        const BOT_API_URL = 'https://api.telegram.org/bot8438607431:AAHQZWYuENj3af5THn8TgFWofTx0WyT8_gU';
        const USER_ID = tg.initDataUnsafe.user.id;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
async function createTask() {
    const title = document.getElementById('taskTitle').value;
    const datetime = document.getElementById('taskDateTime').value;

    if (!title || !datetime) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
    }

    const task = {
        userId: USER_ID,
        title: title,
        datetime: datetime,
        notified: false
    };

    try {
        const RAILWAY_URL = 'https://railwaybot-production-e3bc.up.railway.app';
        
        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–¥–∞—á—É –Ω–∞:', RAILWAY_URL);
        console.log('üìù –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:', task);
        
        const response = await fetch(RAILWAY_URL + '/addtask', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(task)
        });

        console.log('üì• –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
        
        if (response.ok) {
            const result = await response.json();
            console.log('‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
            
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDateTime').value = '';
            alert('‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞! –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 4 —á–∞—Å–∞ –¥–æ –Ω–∞—á–∞–ª–∞.');
        } else {
            const errorText = await response.text();
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', response.status, errorText);
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
    }
}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadTasks() {
    try {
        const RAILWAY_URL = 'https://friendly-enjoyment.up.railway.app';
        const response = await fetch(RAILWAY_URL + '/gettasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                userId: USER_ID
            })
        });

        if (response.ok) {
            const data = await response.json();
            displayTasks(data.tasks);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
    }
}

        function displayTasks(tasks) {
    const taskList = document.getElementById('taskList');
    
    if (!tasks || tasks.length === 0) {
        taskList.innerHTML = '<div class="task-item">üìù –ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</div>';
        return;
    }

    taskList.innerHTML = tasks.map(task => `
        <div class="task-item">
            <div class="task-title">${task.title}</div>
            <div class="task-datetime">üìÖ ${new Date(task.datetime).toLocaleString('ru-RU')}</div>
        </div>
    `).join('');
}


        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        loadTasks();
    </script>
</body>
</html>
